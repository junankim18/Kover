{% extends "layout.html" %} {% block extra_head %} {{block.super}} {%endblock%} {% block content %}
<style>
    button {
        all: unset;
        background-color: steelblue;
        color: white;
        padding: 5px 20px;
        border-radius: 5px;
    }
    .modalbox {
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        position: fixed;
        top: 0px;
        left: 0px;
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
    }
    .modal_overlay {
        background-color: rgba(0, 0, 0, 0.6);
        width: 100%;
        height: 100%;
        position: absolute;
    }
    .modal_content {
        background-color: white;
        border-radius: 15px;
        padding: 70px 10px;
        position: relative;
        width: 30%;
        text-align: center;
    }
    .none {
        display: none;
    }
</style>

<title>Kover | settings</title>

{% comment %} html의 시작 {% endcomment %}

<div>설정</div>
<div class="modalbox none">
    <div class="modal_overlay"></div>
    <div class="modal_content">
        <p>Kover에서 사용할 닉네임을 입력해주세요</p>
        <input type="text" placeholder="닉네임" />
        <button type="submit" onclick="onClickName({{username}})">O</button>
        <p class="validation" style="color: red; font-weight: 600"></p>
    </div>
</div>
<script>
    const modal = document.querySelector('.modalbox');
    const openModal=()=>{
        modal.classList.remove('none')
    }
    const username = {{username}};
    if(username==0){
        openModal();
    }
    const request = new XMLHttpRequest();

    const onClickName=()=>{
        const inputname = document.querySelector('.modalbox input');
        const name = inputname.value;
        const url = '/login/settings/nickname/';
        if(name){
            request.open('POST', url, true);
            request.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
            request.send(JSON.stringify({ name }));
        }
    }

    const handleResponseName =()=>{
        if (request.status <= 400) {
            const { name } = JSON.parse(request.response);
            const validation = document.querySelector('.validation');
            console.log(validation)
            if(name){
                modal.classList.add('none')
            }else if(name==false){
                validation.innerText = '중복된 닉네임입니다. 다시 입력해주세요'
            }
        }
    }

    request.onreadystatechange = () => {
        if (request.readyState === XMLHttpRequest.DONE) {
            handleResponseName();
        }
    };
</script>
{% endblock content %}
