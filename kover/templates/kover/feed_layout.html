<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>feed</title>
</head>
<body>

    {% for feed in feeds %}
    <div class="wrapper post-{{ feed.id }}" >  
        <div>
            <h2 class="title"> {{ feed.feed_title }} </h2>
            <div class="content"> {{ feed.feed_content }} </div>
            <div class="comment_t">댓글
                {% for comment in feed.comments.all %}
                    <div class="comment"> {{ Feed_comment.comment_content }} </div>
                {% endfor %}
            </div>
            
            <button type="submit" onclick="onClickBtn({{ feed.id }})" name="type" value="like">
            추천 {{ feed.feed_like }}</button>
            

            <form method="post">
                {% csrf_token %}
                    <input class="comment_content" type="text" placeholder="댓글 달기"/>
                    <input class="sbmbtn"type="submit" onclick="onClickBtnCMT({{ subject.id }})" value="게시"/>
                </form>
        </div>    
    </div>
    {% endfor %}



<script>
    const request = new XMLHttpRequest();

    const onClickBtn = (id) => {
        const url = "/feed/";
        request.open("POST", url, true);
        request.setRequestHeader(
            "Content-Type",
            "application/x-www-form-urlencoded"
        );
        request.send(JSON.stringify({id: id }));
    };

    const handleResponse = () => {
        if (request.status <= 400) {
            const { id, type } = JSON.parse(request.response);
            
            const element = document.querySelector(`#post-${id} button[value=${type}]`);
                const origin = element.innerText;
                const [typeStr, num] = origin.split(' '); 
                const count = Number(num) + 1;
                element.innerText = `${typeStr} ${count}`;

        }
    };

    request.onreadystatechange = () => {
        if (request.readyState === XMLHttpRequest.DONE) {
            handleResponse();
        }
    };







    const onClickBtnCMT = (id) => {
        const url = "/feed/";
        const value = document.querySelector(
                `.comment_create-${id} .comment_content`);
        request.open("POST", url, true);
        request.setRequestHeader(
            "Content-Type",
            "application/x-www-form-urlencoded"
        );
        request.send(JSON.stringify({id: id }));
    };

    
</script>





</body>
</html>