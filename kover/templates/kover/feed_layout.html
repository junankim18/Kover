{% extends "layout.html" %} {% block extra_head %} {{block.super}} {%endblock%} {% block content %} {% comment %}
<div></div>
{% endcomment %} {% for feed in feeds%}
<h1>{{ feed.feed_type }}</h1>
<div id="post-{{feed.id}}" class="wrapper">
    <div>
        <h2 class="title">{{ feed.feed_title }}</h2>
        <div class="content">{{ feed.feed_content }}</div>
        <div class="author">{{ feed.feed_author }}</div>
        <div class="feed_created_at">{{ feed.feed_created_at }}</div>
        <button type="submit" onclick="onClickLike({{ feed.id }})">추천 {{ feed.feed_like }}</button>
        댓글 개수 : {{ feed.comment_post }}

        <div class="comment_t">
            댓글 {% for comment in feed.comments.all %}
            <div class="comment">{{ Feed_comment.comment_content }}</div>
            {% endfor %}
        </div>

        <form method="post">
            {% csrf_token %}
            <input class="comment_content" type="text" placeholder="댓글 달기" />
            <input class="sbmbtn" type="submit" onclick="onClickLike({{ subject.id }})" value="게시" />
        </form>
    </div>
</div>
{% endfor %}

<script>
    const request = new XMLHttpRequest();

    const onClickLike = (id) => {
        const url = "/feed/like/";
        request.open("POST", url, true);
        request.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
        request.send(JSON.stringify({ id }));
    };

    const handleResponse = () => {
        if (request.status <= 400) {
            const { id, type } = JSON.parse(request.response);
            const element = document.querySelector(`#post-${id} div button`);
            const origin = element.innerText;
            const [typeStr, num] = origin.split(" ");
            const count = Number(num) + 1;
            element.innerText = `${typeStr} ${count}`;
            console.log(typeStr, count);
        }
    };

    request.onreadystatechange = () => {
        if (request.readyState === XMLHttpRequest.DONE) {
            handleResponse();
        }
    };
</script>
{% endblock %}
